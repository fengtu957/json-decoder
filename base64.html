<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Base64 åœ¨çº¿ç¼–ç è§£ç å·¥å…·</title>
    <style>
      :root {
        color-scheme: light;
        --bg: #f5f6fa;
        --panel: #fff;
        --border: #e3e5ed;
        --text: #1f2633;
        --muted: #6c7485;
        --accent: #1f7aec;
        --danger: #f04438;
        --success: #12b886;
        --font-mono: "Fira Code", "Consolas", "Monaco", "SFMono-Regular", monospace;
        --font-sans: "Segoe UI", "PingFang SC", "Helvetica Neue", Arial, sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;
        font-family: var(--font-sans);
        color: var(--text);
        background: var(--bg);
        display: flex;
        flex-direction: row;
      }

      .sidebar {
        width: 50px;
        background: var(--panel);
        border-right: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        padding: 12px 0;
        gap: 8px;
        box-shadow: 2px 0 8px rgba(31, 38, 51, 0.05);
      }

      .sidebar-link {
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 40px;
        color: var(--muted);
        text-decoration: none;
        font-size: 20px;
        transition: all 120ms ease;
        position: relative;
      }

      .sidebar-link:hover {
        color: var(--accent);
        background: rgba(31, 122, 236, 0.08);
      }

      .sidebar-link.active {
        color: var(--accent);
        background: rgba(31, 122, 236, 0.12);
      }

      .sidebar-link.active::before {
        content: '';
        position: absolute;
        left: 0;
        top: 8px;
        bottom: 8px;
        width: 3px;
        background: var(--accent);
        border-radius: 0 2px 2px 0;
      }

      .main-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 0;
      }

      .panel-header {
        padding: 10px 18px;
        border-bottom: 1px solid var(--border);
        font-size: 14px;
        font-weight: 600;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        height: 48px;
        box-sizing: border-box;
      }

      .panel-header .panel-actions {
        display: flex;
        gap: 4px;
        flex-wrap: nowrap;
        justify-content: flex-start;
        align-items: center;
        overflow-x: auto;
        overflow-y: hidden;
        flex: 1;
        min-width: 0;
      }

      .panel-header .panel-actions::-webkit-scrollbar {
        height: 4px;
      }

      .panel-header .panel-actions::-webkit-scrollbar-thumb {
        background: var(--border);
        border-radius: 2px;
      }

      button {
        appearance: none;
        border: 1px solid transparent;
        border-radius: 5px;
        padding: 4px 10px;
        font-size: 12px;
        background: var(--panel);
        color: var(--text);
        cursor: pointer;
        box-shadow: 0 1px 2px rgba(31, 38, 51, 0.08);
        transition: transform 120ms ease, box-shadow 120ms ease;
      }

      button.primary {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 6px 14px rgba(31, 38, 51, 0.2);
      }

      button:active {
        transform: translateY(0);
      }

      main {
        flex: 1;
        display: flex;
        gap: 16px;
        padding: 0 clamp(16px, 4vw, 48px) clamp(16px, 3vw, 32px);
        margin-top: 20px;
      }

      .panel {
        flex: 1 1 50%;
        background: var(--panel);
        border: 1px solid var(--border);
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        box-shadow: 0 12px 30px rgba(31, 38, 51, 0.1);
        min-width: 0;
      }

      textarea {
        flex: 1;
        width: 100%;
        resize: none;
        border: none;
        outline: none;
        font-family: var(--font-mono);
        font-size: 14px;
        padding: 16px 18px;
        line-height: 1.5;
        color: var(--text);
        white-space: pre;
        overflow: auto;
      }

      textarea::placeholder {
        color: var(--muted);
      }

      .status {
        padding: 10px 18px;
        border-top: 1px solid var(--border);
        font-size: 13px;
        color: var(--muted);
        min-height: 40px;
      }

      .status.success {
        color: var(--success);
      }

      .status.error {
        color: var(--danger);
      }

      @media (max-width: 960px) {
        main {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <nav class="sidebar">
      <a href="index.html" class="sidebar-link" title="JSON æ ¼å¼åŒ–">{ }</a>
      <a href="base64.html" class="sidebar-link active" title="Base64 ç¼–ç ">B64</a>
      <a href="timestamp.html" class="sidebar-link" title="æ—¶é—´æˆ³è½¬æ¢">ğŸ•</a>
    </nav>
    <div class="main-content">
    <main>
      <section class="panel">
        <div class="panel-header">
          <span>è¾“å…¥æ–‡æœ¬</span>
          <div class="panel-actions">
            <button class="primary" id="encode-btn">ç¼–ç </button>
            <button id="clear-input-btn">æ¸…ç©º</button>
            <button id="copy-input-btn">å¤åˆ¶</button>
          </div>
        </div>
        <textarea
          id="input-text"
          spellcheck="false"
          placeholder="åœ¨æ­¤è¾“å…¥è¦ç¼–ç çš„æ–‡æœ¬ï¼Œæ”¯æŒä¸­æ–‡..."
        ></textarea>
        <div class="status" id="input-status">ç­‰å¾…è¾“å…¥...</div>
      </section>

      <section class="panel">
        <div class="panel-header">
          <span>Base64 ç»“æœ</span>
          <div class="panel-actions">
            <button class="primary" id="decode-btn">è§£ç </button>
            <button id="clear-output-btn">æ¸…ç©º</button>
            <button id="copy-output-btn">å¤åˆ¶</button>
          </div>
        </div>
        <textarea
          id="output-text"
          spellcheck="false"
          placeholder="Base64 ç¼–ç ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¿™é‡Œè¾“å…¥ Base64 è¿›è¡Œè§£ç ..."
        ></textarea>
        <div class="status" id="output-status">ç­‰å¾…æ“ä½œ...</div>
      </section>
    </main>
    </div>

    <script>
      const inputEl = document.getElementById("input-text");
      const outputEl = document.getElementById("output-text");
      const inputStatusEl = document.getElementById("input-status");
      const outputStatusEl = document.getElementById("output-status");

      const HISTORY_LIMIT = 200;
      const inputHistory = createHistory();
      const outputHistory = createHistory();

      function createHistory() {
        return {
          stack: [],
          index: -1,
          push(value) {
            if (this.index >= 0 && this.stack[this.index] === value) {
              return;
            }
            if (this.index < this.stack.length - 1) {
              this.stack = this.stack.slice(0, this.index + 1);
            }
            this.stack.push(value);
            if (this.stack.length > HISTORY_LIMIT) {
              this.stack.shift();
              this.index = this.stack.length - 1;
            } else {
              this.index += 1;
            }
          },
          undo() {
            if (this.index <= 0) return null;
            this.index -= 1;
            return this.stack[this.index];
          },
          redo() {
            if (this.index >= this.stack.length - 1) return null;
            this.index += 1;
            return this.stack[this.index];
          },
        };
      }

      inputHistory.push(inputEl.value || "");
      outputHistory.push(outputEl.value || "");

      // ç¼–ç æŒ‰é’®
      document.getElementById("encode-btn").addEventListener("click", () => {
        const text = inputEl.value;
        if (!text.trim()) {
          updateStatus(inputStatusEl, "è¯·è¾“å…¥è¦ç¼–ç çš„æ–‡æœ¬", "muted");
          return;
        }

        try {
          // ä½¿ç”¨ UTF-8 ç¼–ç æ”¯æŒä¸­æ–‡
          const encoded = btoa(unescape(encodeURIComponent(text)));
          setTextValue(outputEl, encoded, outputHistory);
          updateStatus(inputStatusEl, "ç¼–ç æˆåŠŸ", "success");
          updateStatus(outputStatusEl, `å·²ç”Ÿæˆ Base64ï¼ˆ${encoded.length} å­—ç¬¦ï¼‰`, "success");
        } catch (error) {
          updateStatus(inputStatusEl, `ç¼–ç å¤±è´¥ï¼š${error.message}`, "error");
        }
      });

      // è§£ç æŒ‰é’®
      document.getElementById("decode-btn").addEventListener("click", () => {
        const text = outputEl.value;
        if (!text.trim()) {
          updateStatus(outputStatusEl, "è¯·è¾“å…¥è¦è§£ç çš„ Base64 æ–‡æœ¬", "muted");
          return;
        }

        try {
          // ä½¿ç”¨ UTF-8 è§£ç æ”¯æŒä¸­æ–‡
          const decoded = decodeURIComponent(escape(atob(text.trim())));
          setTextValue(inputEl, decoded, inputHistory);
          updateStatus(outputStatusEl, "è§£ç æˆåŠŸ", "success");
          updateStatus(inputStatusEl, `å·²è¿˜åŸæ–‡æœ¬ï¼ˆ${decoded.length} å­—ç¬¦ï¼‰`, "success");
        } catch (error) {
          updateStatus(outputStatusEl, `è§£ç å¤±è´¥ï¼š${error.message}`, "error");
        }
      });

      // æ¸…ç©ºæŒ‰é’®
      document.getElementById("clear-input-btn").addEventListener("click", () => {
        setTextValue(inputEl, "", inputHistory);
        updateStatus(inputStatusEl, "å†…å®¹å·²æ¸…ç©º", "muted");
      });

      document.getElementById("clear-output-btn").addEventListener("click", () => {
        setTextValue(outputEl, "", outputHistory);
        updateStatus(outputStatusEl, "å†…å®¹å·²æ¸…ç©º", "muted");
      });

      // å¤åˆ¶æŒ‰é’®
      document.getElementById("copy-input-btn").addEventListener("click", () => {
        copyText(inputEl, inputStatusEl);
      });

      document.getElementById("copy-output-btn").addEventListener("click", () => {
        copyText(outputEl, outputStatusEl);
      });

      // å†å²è®°å½•
      inputEl.addEventListener("input", () => {
        inputHistory.push(inputEl.value);
      });

      outputEl.addEventListener("input", () => {
        outputHistory.push(outputEl.value);
      });

      // æ’¤é”€/é‡åšå¿«æ·é”®
      inputEl.addEventListener("keydown", (event) => {
        handleHistoryKeydown(event, inputEl, inputHistory, inputStatusEl);
      });

      outputEl.addEventListener("keydown", (event) => {
        handleHistoryKeydown(event, outputEl, outputHistory, outputStatusEl);
      });

      function handleHistoryKeydown(event, element, history, statusEl) {
        if (event.key.toLowerCase() !== "z" || !event.ctrlKey) {
          return;
        }
        event.preventDefault();
        if (event.shiftKey) {
          const redoValue = history.redo();
          if (redoValue !== null) {
            applyHistoryValue(element, redoValue);
            updateStatus(statusEl, "å·²å‰è¿›ä¸€æ­¥", "success");
          }
          return;
        }
        const undoValue = history.undo();
        if (undoValue !== null) {
          applyHistoryValue(element, undoValue);
          updateStatus(statusEl, "å·²å›é€€ä¸€æ­¥", "success");
        }
      }

      function applyHistoryValue(element, value) {
        element.value = value;
        resetScroll(element);
      }

      function setTextValue(element, value, history) {
        element.value = value;
        resetScroll(element);
        history.push(value);
      }

      function resetScroll(element) {
        element.scrollLeft = 0;
        element.scrollTop = 0;
      }

      async function copyText(element, statusEl) {
        try {
          if (!element.value.trim()) {
            updateStatus(statusEl, "æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹", "muted");
            return;
          }
          await navigator.clipboard.writeText(element.value);
          updateStatus(statusEl, "å·²å¤åˆ¶åˆ°å‰ªè´´æ¿", "success");
        } catch (error) {
          updateStatus(statusEl, "å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨é€‰æ‹©æ–‡æœ¬å¤åˆ¶", "error");
        }
      }

      function updateStatus(statusEl, message, type) {
        statusEl.textContent = message;
        statusEl.className = `status ${type || ""}`;
      }
    </script>
  </body>
</html>
